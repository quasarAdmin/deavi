<!--
Copyright (C) 2016-2018 Quasar Science Resources, S.L.

This file is part of DEAVI.

DEAVI is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

DEAVI is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with DEAVI.  If not, see <http://www.gnu.org/licenses/>.
-->
<!DOCTYPE html>
<html lang="en">
  <head>
    {% include "avi/header.html" %}
    {% load static %}
    <script src="{% static 'avi/js/poll.js' %}"></script>
    <!-- <link rel="stylesheet" href="{% static 'avi/style.css' %}"> -->
  </head>
  <body>
    {% csrf_token %}
  <div id="navbar">
    {% include "avi/navbar.html" %}
  </div>
  <div class="container-fluid">
  <div id="content" class="row content">
    <div id="sidebar" class="col-sm-2 sidenav">
      {% include "avi/sidebar-nav.html" with sidebar_menu="queries"%}
    </div>
    <div id="real-content" class="col-sm-10">
      <!-- ----------------------------------------------------------------- -->
      <!-- ----------------------------------------------------------------- -->
      <!-- ----------------------------------------------------------------- -->
      {% if update == True %}
      <script>
	window.location.reload();
      </script>
      <h1>{{ update }}</h1>
      {% endif %}
      <h1>Queries Status</h1>
      <div class="table text-center">
	<div class="table-row heading">
          <div class="table-head">
            <div class="row-sm-12">
	      <div class="col-sm-4 cell-border text-left sort-by-name">
	        Name
	      </div>
	      <div class="col-sm-4 cell-border sort-by-date">
	        Date
	      </div>
	      <div class="col-sm-2 cell-border sort-by-status">
	        Status
	      </div>
	      <div class="col-sm-1 cell-border">
	        Info
	      </div>
	      <div class="col-sm-1 cell-border">
	        Abort
	      </div>
            </div>
	  </div>
        </div>
	{% for q in queries.items %}
	<div class="table-row data">
          <div class="table-cell">
            <div class="row-sm-12">
	      <div id="{{ q.1.5 }}_{{ q.1.4 }}"
                   mission="{{ q.1.5 }}"
                   qid="{{ q.1.4 }}"
                   title="TODO"
                   class="col-sm-4 text-left cell-border query-info
                          hover-info">
	        {# {{queries|get_item:q}} #}
	        {{ q.1.0 }} - {{ q.1.4 }}
	      </div>
	      <div class="col-sm-4 cell-border">
	        {{ q.1.2 }}
	      </div>
	      <div class="col-sm-2 cell-border">
	        {{ q.1.1 }}
	      </div>
	      <div class="col-sm-1 cell-border">
	        {{ q.1.3 }}
	      </div>
	      <div class="col-sm-1 cell-border">
                <form id="form_{{ q.1.4 }}"
                      method="post">
                  {% csrf_token %}
                  <button
                     type="submit"
                     class="btn btn-primary btn-block"
                     formmethod="POST"
                     id="form_button_{{ q.1.4 }}" 
                     {% if q.1.1 in "SUCCESS" or q.1.1 in "FAILURE" %}
                     name="delete_{{ q.1.5 }}"
                     title="Delete" 
                     value="{{ q.1.4 }}">
                    Delete
                    {% else %}
                    name="abort_{{ q.1.5 }}"
                    title="Abort" 
                    value="{{ q.1.4 }}">
                    Abort
                    {% endif %}
                  </button>
                </form>
              </div>
            </div>
	  </div>
	</div>
        <div id="div_qs-res_{{ q.1.5 }}_{{ q.1.4 }}"
             class="table-row data qs-res" style="display: none">
          <div class="table-cell text-left">
            <div class="row-sm-12">
              {% with id=q.1.4 name=q.1.0 mission=q.1.5 %}
              {% include "avi/query_results.html" %}
              {% endwith %}
            </div>
          </div>
        </div>
	{% endfor %}
      </div>
      <div class="table-footer text-right">
	<!-- <a href="#">{{ ppage }} - {{ npage }} - {{ cpage }} - {{ pages }}</a> -->
        <form id="form_page"
              method="post">
          {% csrf_token %}
          <button
             type="submit"
             class="btn btn-primary"
             formmethod="POST"
             id="first_page_button" 
             name="page"
             title="Page" 
             value="1">
            First
          </button>
          <button
             type="submit"
             class="btn btn-primary"
             formmethod="POST"
             id="prev_page_button" 
             name="page"
             title="Page" 
             value="{{ ppage }}">
            Prev
          </button>
          Page {{ cpage }} of {{ pages }}
          <button
             type="submit"
             class="btn btn-primary"
             formmethod="POST"
             id="next_page_button" 
             name="page"
             title="Page" 
             value="{{ npage }}">
            Next
          </button>
          <button
             type="submit"
             class="btn btn-primary"
             formmethod="POST"
             id="last_page_button" 
             name="page"
             title="Page" 
             value="{{ pages }}">
            Last
          </button>
        </form>
      </div>
      <!-- ----------------------------------------------------------------- -->
      <!-- ----------------------------------------------------------------- -->
      <!-- ----------------------------------------------------------------- -->
    </div>
  </div>
  </div>
</body>
</html>
