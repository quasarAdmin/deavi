<!--
Copyright (C) 2016-2018 Quasar Science Resources, S.L.

This file is part of DEAVI.

DEAVI is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

DEAVI is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with Foobar.  If not, see <http://www.gnu.org/licenses/>.
-->
<!DOCTYPY html>
<html lang="en">
  <!-- Start HEAD --> 
  <head>
    {% include "avi/header.html" %}
  
  {% load static %}
    <link rel="stylesheet"
    type="text/css" href="{% static 'avi/css/resources_filemanager.css' %}"/>
    <script src="{% static 'avi/lib/samp.js' %}"></script>   
    <script src="{% static 'avi/js/samp.js' %}"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  </head>
  <!-- End HEAD -->
  <!-- Start BODY --> 
  <body>
    <div id="navbar">{% include "avi/navbar.html" %}</div>
    <div class="container-fluid">
      <div id="content" class="row content">
        <div id="sidebar" class="col-sm-2 sidenav">
	     {% include "avi/sidebar-nav.html" with sidebar_menu="resources"%}
	    </div>
	    <div id="real-content" class="col-sm-10">
    	<!-- -------------------------------------------------------------- -->
    	<!-- -------------------------------------------------------------- -->
    	<!-- -------------------------------------------------------------- -->
    	 <h1>Local</h1>
         <!-- Start GENERAL BUTTONS --> 
         <div class="col-inline-button"> 
          <!-- Start Home button --> 
          <form id = "home_form" class="col-inline-button">
            <div class="col-inline-button">  
              {% csrf_token %}
              <button 
                type="submit" 
                class="btn btn-primary" 
                formmethod="POST"
                id="home_button" 
                name="go_home"
                title="Home" 
                value="home">
                  <span class="glyphicon glyphicon-home"></span>
              </button>
            </div>
          </form>       
          <!-- End Home button --> 
          <!-- Start Up button -->
          <form id = "up_form" class="col-inline-button">
            <div class="col-inline-button">
              {% csrf_token %} 
              <button 
                type="submit" 
                class="btn btn-primary" 
                formmethod="POST"
                id="up_directory_button" 
                name="up_directory"
                title="Up" 
                value="up_directory">
                  <span class="glyphicon glyphicon-arrow-up"></span>
              </button>
            </div>
          </form>       
          <!-- End Up button -->     
         </div>
         <br><br>
      <!-- End GENERAL BUTTONS -->
    <!-- Start CENTRAL TABLE --> 
         <div class="table text-center">
          <!-- Start Header Table -->
          <div class="table-row heading">
            <div class="table-head text-left">Name</div>
            <div class="table-head cell-size-1">Size</div>
            <div class="table-head text-left">File Manager</div>
          </div>
          <!-- End Header Table -->
          <!-- Start directories Table -->
          {% for directory, size in directories_list.items %}
          <div class="table-row data">
            <div class="table-cell text-left">
              <form  id={{directory}}>
                {% csrf_token %}
                <!-- Start folder icon -->
                <span class="glyphicon glyphicon-folder-open"></span>
                <!-- End folder icon -->
                <!-- Start directories buttons -->
                <button class="btn btn-link" 
                  role="link" 
                  type="submit"
                  formmethod="POST" 
                  name="{{directories_list|getkey:directory}}"
                  id="{{directories_list|getkey:directory}}" 
                  value="{{directories_list|getkey:directory}}">
                  {{directories_list|getkey:directory}}
                </button>
                <!-- End directories buttons -->
              </form>
            </div>
            <div class="table-cell cell-size-1">{{size}}</div>
            <div class="table-cell text-left"></div>                  
         </div>    
         {% endfor %}
         <!-- End directories Table -->
         <!-- Start files Table -->
         {% for file, data in files_list.items %}
         <div class="table-row data">
          <div class="table-cell text-left">
            <form  id="form_name_{{ file }}">
              {% csrf_token %}
              <!-- Start files buttons -->        
              <button class="btn btn-link" 
                role="link" 
                type="submit"
                formmethod="POST" 
                name="button_name_{{ file }}"
                id="button_name_{{ file }}" 
                value="{{ file.1 }}">
                {{ data.0 }}
              </button>       
          <!-- End files buttons -->             
            </form>
          </div>
          <!-- Start Size files -->
          <div class="table-cell cell-size-1">{{ data.1}}</div>
          <!-- End Size files -->
          <!-- Start actions buttons files -->
          <div class="table-cell text-left">
            <!-- Start Delete file button-->
            <form class="col-inline-button">
              <div class="col-inline-button">
                {% csrf_token %}
                <button 
                  type="button" 
                  class="btn btn-danger" 
                  data-toggle="modal"
                  data-target="#call_delete_file_{{ file|cut:"." }}" 
                  id="pre_delete_file_button_{{ file|cut:" " }}" 
                  name="{{files_list|getkey:file}}"
                  title="Delete {{ data.0 }}" 
                  value="pre_delete_file_{{ file|cut:" " }}"
                  data-whatever="@fat">
                  <span class="glyphicon glyphicon-trash"></span>
                </button>
                <!-- End Delete file button -->
              </div>
              <!-- Start Delete file button pop up -->
              <div class="modal fade" tabindex="-1" role="dialog"
                aria-labelledby="confirmation_file_modal" aria-hidden="true"
                id="call_delete_file_{{ file|cut:"." }}">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <button type="button"
                        class="close" 
                        data-dismiss="modal" 
                        aria-label="Close">
                          <span aria-hidden="true">&times;</span>
                      </button>
                      <div class="alert alert-warning alert-white rounded">
                        <h4 class="modal-title"
                          id="modal_confirmation_file_pop_up_{{files_list|getkey:file}}">
                          <img src="https://vignette.wikia.nocookie.net/lego/images/c/cd/Warning_sign.png/revision/latest/scale-to-width-down/1000?cb=20110705195119" width="42" height="42">
                          Are you sure you want to permanently delete 
                          <strong>"{{ data.0 }}" </strong>?
                        </h4>
                      </div>
                      <div class="modal-footer">
                        <button
                          type="submit"
                          formmethod="POST" 
                          type="button"
                          name="delete_file" 
                          class="btn btn-default"
                          value="{{ data.0 }}"
                          title="Click to delete the file" 
                          id="modal_btn__delete_yes_file">Yes
                        </button>
                        <button 
                          type="button"
                          data-dismiss="modal" 
                          class="btn btn-primary"
                          title="Click to close" 
                          id="modal_btn_no_file">No
                        </button>     
                      </div>     
                    </div>
                  </div>
                </div>
                <div class="alert" role="alert" id="result"></div>
              </div>                 
            </form>
            <!-- End Delete file button pop up -->
            <!-- Start Download file button-->
            <form class="col-inline-button"  action="{{ avi_url }}avi/api/resource/{{ file }}">
              <div class="col-inline-button">
                {% csrf_token %}
                <button class="btn btn-success"
                  type="submit" 
                  value="download"
                  title="Download {{ data.0 }}">
                  <span class="glyphicon glyphicon-cloud-download"></span>
                </button>  
              </div>
            </form>
            <!-- End Download file button -->  
            <!-- Start SAMP file button-->
            <div class="col-inline-button">
              {% csrf_token %}
              <button
                type="button" 
                class="btn btn-warning samp_button"
                id="samp_button_{{ file }}"
                onclick="samp_send({{ file }},'{{ data.0 }}')"
                title="Send to SAMP {{ data.0 }}">
                <span class="glyphicon glyphicon-send"></span>  
              </button>
            </div>
            <!-- End SAMP file button-->       
          </div>
          <!-- End actions buttons files --> 
         </div>
         {% endfor %}
         <!-- End files Table -->
	    </div>
        <!-- Start foot Table -->
	    <div class="table-footer text-right">
              <!-- <a href="#">{{ ppage }} - {{ npage }} - {{ cpage }} - {{ pages }}</a> -->
              <form id="form_page"
                    method="post">
                {% csrf_token %}
                <button
                   type="submit"
                   class="btn btn-primary"
                   formmethod="POST"
                   id="first_page_button" 
                   name="page"
                   title="Page" 
                   value="1">
                  First
                </button>
                <button
                   type="submit"
                   class="btn btn-primary"
                   formmethod="POST"
                   id="prev_page_button" 
                   name="page"
                   title="Page" 
                   value="{{ ppage }}">
                  Prev
                </button>
                <button
                   type="submit"
                   class="btn btn-primary"
                   formmethod="POST"
                   id="next_page_button" 
                   name="page"
                   title="Page" 
                   value="{{ npage }}">
                  Next
                </button>
                <button
                   type="submit"
                   class="btn btn-primary"
                   formmethod="POST"
                   id="last_page_button" 
                   name="page"
                   title="Page" 
                   value="{{ pages }}">
                  Last
                </button>
              </form>
	    </div>
            <div id="samp-test"></div>
         <!-- End foot Table -->
    <!-- End CENTRAL TABLE -->
    <!-- ----------------------------------------------------------------- -->
    <!-- ----------------------------------------------------------------- -->
    <!-- ----------------------------------------------------------------- -->
      </div>
     </div>
    </div>
  </body>
</html>
